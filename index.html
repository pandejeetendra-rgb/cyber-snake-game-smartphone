<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cyber Security Snake Game ‚Äì Level 1</title>
<style>
  body { margin:0; background:#0e0e0e; color:#fff; font-family:Arial,sans-serif; text-align:center; }
  h1 { margin:12px 0; color:#00e0ff; font-size:20px; }
  #gameContainer { display:flex; flex-direction:column; align-items:center; }
  canvas { background:#000; border:2px solid #00e0ff; border-radius:10px; margin-top:8px; }
  #question { color:#00e0ff; font-size:16px; margin:10px 0 4px; }
  #options { display:flex; flex-direction:column; gap:6px; width:92%; max-width:360px; margin:0 auto 6px; }
  .opt-row { display:flex; align-items:center; gap:10px; padding:8px 10px; border:1px solid #00e0ff; border-radius:8px; background:#121212; }
  .swatch { width:18px; height:18px; border:1px solid #fff; border-radius:3px; flex:0 0 18px; }
  .opt-text { text-align:left; flex:1; }
  #feedback { min-height:20px; margin:4px 0 8px; font-size:14px; }
  #controls { display:flex; flex-direction:column; align-items:center; gap:6px; margin:6px 0 14px; }
  .row { display:flex; gap:10px; justify-content:center; }
  .btn { width:58px; height:58px; border-radius:10px; border:none; background:#00e0ff; color:#000; font-size:26px; }
  #submitBtn {
    display:none; margin-top:10px; background:#00ff88; color:#000; border:none;
    padding:10px 20px; border-radius:8px; font-size:16px; cursor:pointer;
  }
  @media (max-width:600px){
    canvas { width:90vw; height:90vw; }
    .btn { width:56px; height:56px; font-size:26px; }
  }
</style>
</head>
<body>
  <h1>üêç Cyber Security Snake Game ‚Äì Level 1</h1>

  <div id="gameContainer">
    <canvas id="gameCanvas" width="300" height="300"></canvas>
    <div id="question"></div>
    <div id="options"></div>
    <div id="feedback"></div>

    <div id="controls">
      <div class="row"><button class="btn" id="up">‚¨ÜÔ∏è</button></div>
      <div class="row">
        <button class="btn" id="left">‚¨ÖÔ∏è</button>
        <button class="btn" id="down">‚¨áÔ∏è</button>
        <button class="btn" id="right">‚û°Ô∏è</button>
      </div>
    </div>
    <button id="submitBtn">Submit Score üèÜ</button>
  </div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbwyhRoswSaVI7FRiy-miuUuVrlaLitre_EpxmXloe5zMBfQdXFZAh-w5CmPc09LIjsyWQ/exec";

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const box = 15;
let snake = [{ x: 5*box, y: 5*box }];
let dir = "RIGHT";
let score = 0;
let speed = 340;
let foods = [];
let currentQuestion = 0;
const questionsPerLevel = 5;
const colors = ["red", "yellow", "green", "blue"];
let gameInterval = null;

const questions = [
  { q:"Which is a strong password?", opts:["123456","password","Q#4tY9$2","abcdef"], a:2 },
  { q:"What is phishing?", opts:["Fishing","Tricking users","Video chat","Virus"], a:1 },
  { q:"Firewall protects your?", opts:["Network","Printer","Battery","Display"], a:0 },
  { q:"Safe email practice?", opts:["Click all links","Ignore spam","Share passwords","Open attachments"], a:1 },
  { q:"What should you do if you get a suspicious link?", opts:["Click it","Ignore it","Share it","Bookmark it"], a:1 },
  { q:"What is a strong authentication method?", opts:["2FA","Simple password","Open Wi-Fi","Public login"], a:0 },
  { q:"Which one is NOT malware?", opts:["Trojan","Worm","Antivirus","Spyware"], a:2 },
  { q:"VPN stands for?", opts:["Virtual Private Network","Verified Personal Network","Visible Public Node","Virtual Privacy Name"], a:0 }
];

document.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft" && dir!=="RIGHT") dir="LEFT";
  if(e.key==="ArrowUp" && dir!=="DOWN") dir="UP";
  if(e.key==="ArrowRight" && dir!=="LEFT") dir="RIGHT";
  if(e.key==="ArrowDown" && dir!=="UP") dir="DOWN";
  e.preventDefault();
});
document.getElementById("up").onclick    = ()=>{ if(dir!=="DOWN")  dir="UP"; };
document.getElementById("down").onclick  = ()=>{ if(dir!=="UP")    dir="DOWN"; };
document.getElementById("left").onclick  = ()=>{ if(dir!=="RIGHT") dir="LEFT"; };
document.getElementById("right").onclick = ()=>{ if(dir!=="LEFT")  dir="RIGHT"; };

function randomCell(){
  return {
    x: Math.floor(Math.random()*(canvas.width/box))*box,
    y: Math.floor(Math.random()*(canvas.height/box))*box
  };
}
function spawnFoods(){
  foods = [];
  for (let i=0;i<4;i++){
    let p = randomCell();
    foods.push({x:p.x, y:p.y, color:colors[i], idx:i});
  }
}
function draw(){
  ctx.fillStyle="#000"; ctx.fillRect(0,0,canvas.width,canvas.height);
  snake.forEach((s,i)=>{ ctx.fillStyle = i===0?"#00e0ff":"#0099aa"; ctx.fillRect(s.x,s.y,box,box); });
  foods.forEach(f=>{ ctx.fillStyle=f.color; ctx.fillRect(f.x,f.y,box,box); });

  let hx=snake[0].x, hy=snake[0].y;
  if(dir==="LEFT") hx-=box;
  if(dir==="RIGHT") hx+=box;
  if(dir==="UP") hy-=box;
  if(dir==="DOWN") hy+=box;

  // wrap-around
  if(hx<0)hx=canvas.width-box;
  if(hy<0)hy=canvas.height-box;
  if(hx>=canvas.width)hx=0;
  if(hy>=canvas.height)hy=0;

  let eaten = foods.findIndex(f=>f.x===hx && f.y===hy);
  if(eaten>-1){
    handleAnswer(eaten);
    foods[eaten]=randomCell();
    foods[eaten].color=colors[eaten];
  } else snake.pop();

  const newHead={x:hx,y:hy};
  if(snake.some((s,i)=>i&&s.x===hx&&s.y===hy)){ clearInterval(gameInterval); gameOver(); }
  snake.unshift(newHead);
  ctx.fillStyle="#fff"; ctx.font="14px Arial"; ctx.fillText("Score: "+score,10,16);
}

function renderQuestion(){
  const q=questions[currentQuestion];
  document.getElementById("question").textContent=q.q;
  const opts=document.getElementById("options");
  opts.innerHTML="";
  q.opts.forEach((t,i)=>{
    const row=document.createElement("div");
    row.className="opt-row";
    const sw=document.createElement("div");
    sw.className="swatch"; sw.style.background=colors[i];
    const tx=document.createElement("div");
    tx.className="opt-text"; tx.textContent=t;
    row.appendChild(sw); row.appendChild(tx);
    opts.appendChild(row);
  });
}

function handleAnswer(colorIndex){
  const q = questions[currentQuestion];
  if(colorIndex===q.a){
    score+=5;
    document.getElementById("feedback").textContent="‚úÖ Correct! +5";
  }else{
    score=Math.max(0,score-2);
    document.getElementById("feedback").textContent="‚ùå Wrong! -2";
  }
  currentQuestion++;
  if(currentQuestion>=questionsPerLevel){
    endLevel();
  }else{
    renderQuestion();
  }
}

function endLevel(){
  clearInterval(gameInterval);
  document.getElementById("feedback").textContent="üéâ Level 1 Complete! Final Score: "+score;
  document.getElementById("submitBtn").style.display="inline-block";
}

function sendScore() {
  const name  = prompt("Enter your name:");
  const email = prompt("Enter your email:");
  const badge = score >= 20 ? "Gold" : score >= 10 ? "Silver" : "Bronze";

  if (!name || !email) {
    alert("Please enter both name and email to submit your score.");
    return;
  }

  const btn = document.getElementById("submitBtn");
  btn.innerText = "‚è≥ Submitting...";
  btn.disabled = true;

  const payload = { name, email, score, level: "Level 1", badge };

  // 1. Try POST first
  fetch(scriptURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload),
    mode: "no-cors"
  })
  .then(() => {
    alert("‚úÖ Score submitted successfully!");
  })
  .catch(() => {
    // 2. Fallback using GET if POST fails
    const params = new URLSearchParams(payload).toString();
    const url = `${scriptURL}?${params}`;
    fetch(url)
      .then(() => alert("‚úÖ Score submitted via fallback method!"))
      .catch(() => alert("‚ö†Ô∏è Could not submit score even with fallback."));
  })
  .finally(() => {
    btn.innerText = "Submit Score üèÜ";
    btn.disabled = false;
  });
}


function startGame(){
  spawnFoods();
  renderQuestion();
  gameInterval=setInterval(draw,speed);
}
startGame();
</script>
</body>
</html>
