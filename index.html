<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Cyber Security Snake Game ‚Äì GBL Version</title>
<style>
  body { margin:0; background:#0e0e0e; color:#fff; font-family:Arial,sans-serif; text-align:center; }
  h1 { margin:14px 0; color:#00e0ff; font-size:20px; }
  #gameContainer { display:flex; flex-direction:column; align-items:center; }
  canvas { background:#000; border:2px solid #00e0ff; border-radius:10px; margin-top:8px; touch-action:none; }
  #hud { margin-top:6px; font-size:14px; color:#b8faff; }
  #question { color:#00e0ff; font-size:16px; margin:10px 0 6px; min-height:22px; }
  #options { display:flex; flex-direction:column; gap:6px; width:92%; max-width:380px; margin:0 auto 8px; }
  .opt-row { display:flex; align-items:center; gap:10px; padding:8px 10px; border:1px solid #00e0ff; border-radius:8px; background:#121212; }
  .swatch { width:18px; height:18px; border:1px solid #fff; border-radius:3px; flex:0 0 18px; }
  .opt-text { text-align:left; flex:1; }
  #feedback { min-height:20px; margin:4px 0 8px; font-size:14px; }
</style>
</head>
<body>
  <h1>üêç Cyber Security Snake Game ‚Äì Game-Based Learning</h1>
  <div id="gameContainer">
    <canvas id="gameCanvas" width="300" height="300"></canvas>
    <div id="hud">Questions answered: <span id="qdone">0</span>/8 ‚Ä¢ Score: <span id="sc">0</span></div>
    <div id="question"></div>
    <div id="options"></div>
    <div id="feedback"></div>
  </div>

<script>
/* =================== CONFIG =================== */
const formBase = "https://forms.gle/oVm2wcRzVikFBqVV7";
const params = new URLSearchParams(window.location.search);
const pid = params.get("pid") || "UOU-GBL-TEST";
const arm = "GBL";

/* =================== GAME STATE =================== */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const box = 15;
let snake = [{ x:5*box, y:5*box }];
let dir = "RIGHT";
let queuedDir = "RIGHT";
let score = 0;
let foods = [];
const colors = ["red","yellow","green","blue"];
let moveInterval = 300;
let acc = 0, lastTs = 0;
let running = true;

let answered = 0;
const totalQuestions = 8;

/* ===== Questions (same as Control Group) ===== */
const questions = [
  {
    q: "Which of the following represents the three key principles of cybersecurity?",
    opts: ["Anonymity, Security, Resilience", "Confidentiality, Integrity, Availability", "Speed, Access, Control", "Detection, Recovery, Response"],
    a: 1
  },
  {
    q: "Which Indian law primarily deals with cybercrimes?",
    opts: ["The Evidence Act", "The IT Act 2000", "The Penal Code 1860", "The RTI Act 2005"],
    a: 1
  },
  {
    q: "Which of these is NOT a goal of data protection?",
    opts: ["Preventing unauthorized access", "Maintaining confidentiality", "Encouraging data leaks", "Ensuring integrity"],
    a: 2
  },
  {
    q: "Which protocol indicates a secure website connection?",
    opts: ["HTTP", "HTTPS", "FTP", "IP"],
    a: 1
  },
  {
    q: "Social engineering primarily exploits:",
    opts: ["Software vulnerabilities", "Human psychology", "Hardware failures", "Encryption errors"],
    a: 1
  },
  {
    q: "Which browser feature helps verify the authenticity of websites?",
    opts: ["Address bar lock icon", "Bookmarks", "Cookies", "History tab"],
    a: 0
  },
  {
    q: "Which is a good smartphone security practice?",
    opts: ["Use public Wi-Fi for banking", "Download apps from unknown sites", "Install updates regularly", "Share passwords via SMS"],
    a: 2
  },
  {
    q: "Which of these is a secure banking habit?",
    opts: ["Sharing OTP with friends", "Saving passwords in browser", "Using two-factor authentication", "Clicking email links for login"],
    a: 2
  }
];
function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} return a;}
shuffle(questions);
let currentQ = null;

/* =================== UI =================== */
const $qdone= document.getElementById("qdone");
const $sc   = document.getElementById("sc");

function updateHUD(){
  $qdone.textContent = String(answered);
  $sc.textContent = String(score);
}

function renderQuestion(){
  const q = currentQ;
  const qDiv = document.getElementById("question");
  const opts = document.getElementById("options");
  qDiv.textContent = q ? q.q : "";
  opts.innerHTML = "";
  if(!q) return;
  q.opts.forEach((text,i)=>{
    const row=document.createElement("div");
    row.className="opt-row";
    const sw=document.createElement("div");
    sw.className="swatch"; sw.style.background=colors[i];
    const tx=document.createElement("div");
    tx.className="opt-text"; tx.textContent=text;
    row.appendChild(sw); row.appendChild(tx);
    opts.appendChild(row);
  });
}

/* =================== Food & movement =================== */
function randCell(){ return { x:Math.floor(Math.random()*(canvas.width/box))*box, y:Math.floor(Math.random()*(canvas.height/box))*box }; }
function equal(a,b){ return a.x===b.x && a.y===b.y; }
function blocked(p){ return snake.some(s=>equal(s,p)) || foods.some(f=>f&&equal(f,p)); }
function spawnFoodFor(i){ let p; do{p=randCell();}while(blocked(p)); foods[i]={x:p.x,y:p.y,color:colors[i],idx:i}; }

/* =================== Input =================== */
function setDirection(newDir){
  if(newDir==="LEFT"  && dir!=="RIGHT") queuedDir="LEFT";
  if(newDir==="RIGHT" && dir!=="LEFT")  queuedDir="RIGHT";
  if(newDir==="UP"    && dir!=="DOWN")  queuedDir="UP";
  if(newDir==="DOWN"  && dir!=="UP")    queuedDir="DOWN";
}
document.addEventListener("keydown",(e)=>{
  if(e.key==="ArrowLeft")setDirection("LEFT");
  if(e.key==="ArrowRight")setDirection("RIGHT");
  if(e.key==="ArrowUp")setDirection("UP");
  if(e.key==="ArrowDown")setDirection("DOWN");
});

/* =================== Question logic =================== */
function nextQuestion(){
  if(questions.length===0) return null;
  return questions.shift();
}
function handleAnswer(colorIdx){
  if(!currentQ) return;
  if(colorIdx===currentQ.a){
    score += 5;
    document.getElementById("feedback").textContent = "‚úÖ Correct! +5";
  } else {
    score = Math.max(0, score - 2);
    document.getElementById("feedback").textContent = "‚ùå Wrong! -2";
  }
  answered++;
  updateHUD();

  if(answered >= totalQuestions){
    running = false;
    document.getElementById("feedback").textContent = "üéØ All questions completed!";
    setTimeout(() => {
      redirectToForm();
    }, 1500);
  } else {
    currentQ = nextQuestion();
    renderQuestion();
  }
}

/* =================== Game mechanics =================== */
function step(){
  dir = queuedDir;
  let hx=snake[0].x, hy=snake[0].y;
  if(dir==="LEFT")hx-=box; if(dir==="RIGHT")hx+=box; if(dir==="UP")hy-=box; if(dir==="DOWN")hy+=box;
  if(hx<0)hx=canvas.width-box; if(hy<0)hy=canvas.height-box;
  if(hx>=canvas.width)hx=0; if(hy>=canvas.height)hy=0;
  const idx=foods.findIndex(f=>f.x===hx&&f.y===hy);
  if(idx>-1){ handleAnswer(idx); spawnFoodFor(idx); } else { snake.pop(); }
  const head={x:hx,y:hy};
  if(snake.some((s,i)=>i&&equal(s,head))){ running=false; document.getElementById("feedback").textContent="üíÄ Game Over!"; setTimeout(()=>redirectToForm(),1500); }
  else snake.unshift(head);
}
function draw(){
  ctx.fillStyle="#000"; ctx.fillRect(0,0,canvas.width,canvas.height);
  foods.forEach(f=>{ctx.fillStyle=f.color; ctx.fillRect(f.x,f.y,box,box);});
  snake.forEach((s,i)=>{ctx.fillStyle=i===0?"#00e0ff":"#0099aa"; ctx.fillRect(s.x,s.y,box,box);});
  ctx.fillStyle="#fff"; ctx.font="14px Arial"; ctx.fillText("Score: "+score,10,16);
}
function loop(ts){
  if(!running){ draw(); return; }
  if(!lastTs) lastTs=ts; const dt=ts-lastTs; lastTs=ts; acc+=dt;
  if(acc>=moveInterval){ step(); acc=0; }
  draw(); requestAnimationFrame(loop);
}

/* =================== Redirect =================== */
function redirectToForm(){
  const redirectUrl = `${formBase}?usp=pp_url&entry.1614294036=${pid}&entry.686742715=${arm}&entry.1506921454=${score}`;
  window.location.href = redirectUrl;
}

/* =================== Start =================== */
function start(){
  foods = new Array(4); for(let i=0;i<4;i++) spawnFoodFor(i);
  currentQ = nextQuestion();
  renderQuestion();
  updateHUD();
  requestAnimationFrame(loop);
}
start();
</script>
</body>
</html>
